#+title: daily issues using codygman/devos

Performance issues could be found easily with the pie-in-the-sky [[file:20210326112259-monitoring_exwm_with_prometheus.org][monitoring exwm with prometheus]]

* My window manager froze because of org-roam/with-editor/automatically kill gpg buffers making an expensive find call
*** time 1: Uhh... things just froze what?
#+begin_example
Debugger entered--entering a function:
  , * substitute-command-keys("Quit")
  call-process-shell-command("/run/current-system/sw/bin/find -L \"/home/cody\" -t..." nil t)
  #<subr shell-command>("/run/current-system/sw/bin/find -L \"/home/cody\" -t..." t nil)
  shell-command--shell-command-with-editor-mode(#<subr shell-command> "/run/current-system/sw/bin/find -L \"/home/cody\" -t..." t nil)
  apply(shell-command--shell-command-with-editor-mode #<subr shell-command> ("/run/current-system/sw/bin/find -L \"/home/cody\" -t..." t))
  shell-command("/run/current-system/sw/bin/find -L \"/home/cody\" -t..." t)
  shell-command-to-string("/run/current-system/sw/bin/find -L \"/home/cody\" -t...")
  org-roam--shell-command-files("/run/current-system/sw/bin/find -L \"/home/cody\" -t...")
  org-roam--list-files-find("/run/current-system/sw/bin/find" "\"/home/cody\"")
  org-roam--list-files("/home/cody")
  org-roam--list-all-files()
  org-roam-db-build-cache()
  org-roam-db-update-cache-on-timer()
  apply(org-roam-db-update-cache-on-timer nil)
  timer-event-handler([t 0 2 0 t org-roam-db-update-cache-on-timer nil idle 0])
#+end_example

*** time 2: my automatic tab creation called on git commit :S
Automatic tab creation on startup is also run when =with-editor= is called (aka when I do a git commit :S)

This also causes =org-roam-directory= to be set globally to =.= meaning anytime I enter my home directory an expensive find command runs on my entire home directory looking for =*.org.gpg= :S

#+begin_example
(org-roam) total: Δ57, files-modified: Δ57, ids: Δ13, links: Δ189, tags: Δ0, titles: Δ57, refs: Δ0, deleted: Δ0
(Shell command succeeded with no output)
creating or switching to tab for: *music*
*music* not setup yet, setting up
error in process filter: ad-Advice-select-window: Wrong type argument: window-live-p, nil
error in process filter: Wrong type argument: window-live-p, nil
creating or switching to tab for: *typing*
*typing* not setup yet, setting up
creating or switching to tab for: *emacs*
*emacs* not setup yet, setting up
~/.emacs.d/readme.org and /home/cody/devos/profiles/develop/emacs/config/readme.org are the same file
creating or switching to tab for: *aws default dashboard*
*aws default dashboard* not setup yet, setting up
error in process filter: ad-Advice-select-window: Wrong type argument: window-live-p, nil
error in process filter: Wrong type argument: window-live-p, nil
error in process filter: ad-Advice-select-window: Wrong type argument: window-live-p, nil
error in process filter: Wrong type argument: window-live-p, nil
creating or switching to tab for: tech roam
tech roam not setup yet, setting up
Diffing changes to be committed (C-g to abort diffing)
When done with a buffer, type C-c C-c
Saving file /home/cody/tech-roam/.git/COMMIT_EDITMSG...
Wrote /home/cody/tech-roam/.git/COMMIT_EDITMSG
Git finished
#+end_example

*** ~NOTE~ I think this only happens on merge commits

* After rebuilding with [[file:20210324202244-devos.org][DevOS]] sometimes networking gets messed up in docker

All of my calls to the internet inside of it fail

* kitty seems to reliably steal focus from exwm

** xelb-debug buffer (I think this is the relevant piece)
#+begin_example
[67:43:12] exwm-input--on-buffer-list-update:	current-buffer=#<buffer *Help*> selected-window=#<window 602 on *Help*>
[67:43:12] exwm-input--on-buffer-list-update:	current-buffer=#<buffer *Help*> selected-window=#<window 602 on *Help*>
[67:43:12] exwm-input--on-buffer-list-update:	current-buffer=#<buffer *Help*> selected-window=#<window 602 on *Help*>
[67:43:12] exwm-input--on-buffer-list-update:	current-buffer=#<buffer kitty: bash<3>> selected-window=#<window 602 on kitty: bash<3>>
[67:43:12] exwm-layout--refresh:	frame=#<frame kitty: bash<3> 0x19fc680>
[67:43:12] exwm-layout--refresh-workspace:	Refresh workspace #<frame kitty: bash<3> 0x19fc680>
[67:43:12] exwm-layout--show:	Show #x3c0000e in #<window 602 on kitty: bash<3>>
[67:43:12] exwm--set-geometry:	Setting #x3c0000e to 1920x500+0+517
[67:43:12] exwm-layout--set-state:	id=#x3c0000e
[67:43:12] exwm-layout--set-client-list-stacking:	
[67:43:12] exwm-layout--refresh:	frame=#<frame kitty: bash<3> 0x19fc680>
[67:43:12] exwm-layout--refresh-workspace:	Refresh workspace #<frame kitty: bash<3> 0x19fc680>
[67:43:12] exwm-layout--show:	Show #x3c0000e in #<window 602 on kitty: bash<3>>
[67:43:12] exwm--set-geometry:	Setting #x3c0000e to 1920x500+0+517
[67:43:12] exwm-layout--set-state:	id=#x3c0000e
[67:43:12] exwm-layout--set-client-list-stacking:	
[67:43:12] exwm-input--update-focus:	focus-window=#<window 602 on kitty: bash<3>> focus-buffer=kitty: bash<3>
[67:43:12] exwm-input--update-focus:	Set focus on #x3c0000e
[67:43:12] exwm-input--on-echo-area-dirty:	
[67:43:12] exwm-manage--on-MapNotify:	id=#x3c0000e
[67:43:12] exwm--on-PropertyNotify:	atom=WM_STATE(401)
[67:43:12] exwm--on-PropertyNotify:	Unhandled: WM_STATE(401)
[67:43:12] exwm-input--on-PropertyNotify:	
[67:43:12] exwm--on-PropertyNotify:	atom=_NET_WM_STATE(366)
[67:43:12] exwm--on-PropertyNotify:	Unhandled: _NET_WM_STATE(366)
[67:43:12] exwm-input--on-PropertyNotify:	
[67:43:12] exwm--on-PropertyNotify:	atom=WM_STATE(401)
[67:43:12] exwm--on-PropertyNotify:	Unhandled: WM_STATE(401)
[67:43:12] exwm-input--on-PropertyNotify:	
[67:43:12] exwm--on-PropertyNotify:	atom=_NET_WM_STATE(366)
[67:43:12] exwm--on-PropertyNotify:	Unhandled: _NET_WM_STATE(366)
[67:43:12] exwm-input--on-PropertyNotify:	
[67:43:12] exwm-input--set-focus:	#xe0001c (corrected) => #x3c0000e
[67:43:12] exwm-input--update-timestamp:	
[67:43:12] exwm--on-PropertyNotify:	atom=_TIME(516)
[67:43:12] exwm-input--on-PropertyNotify:	
[67:43:12] exwm-input--set-active-window:	
[67:43:13] exwm-input--on-KeyPress:	major-mode=exwm-mode buffer=kitty: bash<3>
[67:43:13] exwm-input--on-KeyPress-char-mode:	(98 . 3)
[67:43:13] exwm-input--mimic-read-event:	
[67:43:13] exwm-input--cache-event:	8388706
[67:43:14] exwm-input--on-buffer-list-update:	current-buffer=#<buffer  *Minibuf-1*> selected-window=#<window 4 on  *Minibuf-1*>
[67:43:14] exwm-input--on-minibuffer-setup:	
[67:43:14] exwm-layout--on-minibuffer-setup:	
[67:43:14] exwm-input--on-buffer-list-update:	current-buffer=#<buffer kitty: bash<3>> selected-window=#<window 602 on kitty: bash<3>>
[67:43:14] exwm-layout--refresh:	frame=#<frame  *Minibuf-1* 0x19fc680>
[67:43:14] exwm-layout--refresh-workspace:	Refresh workspace #<frame  *Minibuf-1* 0x19fc680>
[67:43:14] exwm-layout--hide:	Hide #x3c0000e
[67:43:14] exwm-layout--set-state:	id=#x3c0000e
[67:43:14] exwm-layout--set-client-list-stacking:	
[67:43:14] exwm-layout--refresh:	frame=#<frame  *Minibuf-1* 0x19fc680>
[67:43:14] exwm-layout--refresh-workspace:	Refresh workspace #<frame  *Minibuf-1* 0x19fc680>
[67:43:14] exwm-layout--set-client-list-stacking:	
[67:43:14] exwm-input--update-focus:	focus-window=#<window 602 on *Help*> focus-buffer=*Help*
[67:43:14] exwm-layout--refresh:	frame=#<frame  *Minibuf-1* 0x19fc680>
[67:43:14] exwm-layout--refresh-workspace:	Refresh workspace #<frame  *Minibuf-1* 0x19fc680>
[67:43:14] exwm-layout--set-client-list-stacking:	
[67:43:14] exwm-input--on-echo-area-dirty:	
[67:43:14] exwm-input--on-echo-area-dirty:	
[67:43:14] exwm--on-PropertyNotify:	atom=WM_STATE(401)
[67:43:14] exwm--on-PropertyNotify:	Unhandled: WM_STATE(401)
[67:43:14] exwm-input--on-PropertyNotify:	
[67:43:14] exwm--on-PropertyNotify:	atom=_NET_WM_STATE(366)
[67:43:14] exwm--on-PropertyNotify:	Unhandled: _NET_WM_STATE(366)
[67:43:14] exwm-input--on-PropertyNotify:	
[67:43:14] exwm-input--on-buffer-list-update:	current-buffer=#<buffer *Help*> selected-window=#<window 602 on *Help*>
[67:43:14] exwm-layout--refresh:	frame=#<frame  *Minibuf-1* 0x19fc680>
[67:43:14] exwm-layout--refresh-workspace:	Refresh workspace #<frame  *Minibuf-1* 0x19fc680>
[67:43:14] exwm-layout--set-client-list-stacking:	
[67:43:14] exwm-layout--refresh:	frame=#<frame  *Minibuf-1* 0x19fc680>
[67:43:14] exwm-layout--refresh-workspace:	Refresh workspace #<frame  *Minibuf-1* 0x19fc680>
[67:43:14] exwm-layout--set-client-list-stacking:	
[67:43:14] exwm-layout--refresh:	frame=#<frame  *Minibuf-1* 0x19fc680>
[67:43:14] exwm-layout--refresh-workspace:	Refresh workspace #<frame  *Minibuf-1* 0x19fc680>
[67:43:14] exwm-layout--set-client-list-stacking:	
[67:43:14] exwm-layout--refresh:	frame=#<frame  *Minibuf-1* 0x19fc680>
[67:43:14] exwm-layout--refresh-workspace:	Refresh workspace #<frame  *Minibuf-1* 0x19fc680>
[67:43:14] exwm-layout--set-client-list-stacking:	
#+end_example

